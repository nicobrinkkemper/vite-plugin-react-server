{"version":3,"file":"plugin.js","sourceRoot":"","sources":["../../../plugin/react-server/plugin.ts"],"names":[],"mappings":"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","sourcesContent":["import type { ServerResponse } from \"node:http\";\nimport { join, relative, resolve, sep } from \"node:path\";\nimport { performance } from \"node:perf_hooks\";\nimport { Worker } from \"node:worker_threads\";\nimport type { Plugin as RollupPlugin } from \"rollup\";\nimport type { Plugin as VitePlugin } from \"vite\";\nimport {\n  createLogger,\n  normalizePath,\n  type ResolvedConfig,\n  type UserConfig,\n  type ViteDevServer,\n} from \"vite\";\nimport { createBuildConfig } from \"../build/createBuildConfig.js\";\nimport { checkFilesExist } from \"../checkFilesExist.js\";\nimport { getEnv } from \"../getEnv.js\";\nimport { createInputNormalizer } from \"../helpers/inputNormalizer.js\";\nimport { tryManifest } from \"../helpers/tryManifest.js\";\nimport { createPageLoader } from \"../loader/createPageLoader.js\";\nimport { DEFAULT_CONFIG, resolveOptions, resolvePages, resolveUserConfig } from \"../options.js\";\nimport type { BuildTiming, ReactStreamPluginMeta, ResolvedUserConfig, ResolvedUserOptions } from \"../types.js\";\nimport { type StreamPluginOptions } from \"../types.js\";\nimport { createWorker } from \"../worker/createWorker.js\";\nimport { renderPages } from \"../worker/renderPages.js\";\nimport { createHandler } from \"./createHandler.js\";\n\nlet files: Awaited<ReturnType<typeof checkFilesExist>>;\nlet env: Awaited<ReturnType<typeof getEnv>>;\nlet worker: Worker;\nlet config: ResolvedConfig;\nlet cssModules = new Set<string>();\nlet clientComponents = new Map<string, string>();\nlet define: Record<string, string>;\nlet buildCssFiles = new Set<string>();\nlet root: string = process.cwd();\nlet nodeRoot: string = process.env[\"module_root\"] ?? join(root, \"node_modules\");\nlet pluginRoot: string = join(nodeRoot, \"vite-plugin-react-server\");\nlet userConfig: ResolvedUserConfig\nlet userOptions: ResolvedUserOptions;\n\ninterface BuildStats {\n  htmlFiles: number;\n  clientComponents: number;\n  cssFiles: number;\n  totalRoutes: number;\n  timing: {\n    config: number;\n    build: number;\n    render: number;\n    total: number;\n  };\n}\n\nexport async function reactStreamPlugin(\n  options: StreamPluginOptions = {} as StreamPluginOptions\n): Promise<VitePlugin & RollupPlugin & { meta: ReactStreamPluginMeta }> {\n  const timing: BuildTiming = {\n    start: performance.now(),\n  };\n  const resolvedOptions = resolveOptions(options, \"react-server\");\n  if (resolvedOptions.type === \"error\") {\n    console.error(\n      \"[vite-react-stream:server] Error resolving userOptions. Please check your userOptions.\"\n    );\n    throw resolvedOptions.error;\n  }\n  userOptions = resolvedOptions.userOptions;\n  return {\n    name: \"vite:react-stream\",\n    meta: {\n      timing,\n    } as ReactStreamPluginMeta,\n    api: {\n      addCssFile(path: string) {\n        buildCssFiles.add(path);\n      },\n    },\n    configResolved(resolvedConfig) {\n      if (resolvedConfig.command === \"build\") {\n        timing.configResolved = performance.now();\n        console.log(\"[vite-react-stream] Starting build...\");\n      }\n      config = resolvedConfig;\n    },\n    async configureServer(server: ViteDevServer) {\n      if (server.config.root) {\n        console.log(\n          \"[vite-react-stream] Root dir changed\",\n          server.config.root,\n          server.config.root\n        );\n      }\n\n      const activeStreams = new Set<ServerResponse>();\n\n      // Handle Vite server restarts\n      server.ws.on(\"restart\", (path) => {\n        console.log(\n          \"[vite-react-stream] ðŸ”§ Plugin changed, preparing for restart:\",\n          path\n        );\n\n        // Close streams with restart message\n        for (const res of activeStreams) {\n          res.writeHead(503, {\n            \"Content-Type\": \"text/x-component\",\n            \"Retry-After\": \"1\",\n          });\n          res.end('{\"error\":\"Server restarting...\"}');\n        }\n        activeStreams.clear();\n      });\n\n      server.ws.on(\"connection\", (socket, req) => {\n        console.log(\"[vite-react-stream] hooking up ws connection\");\n      });\n\n      server.ws.on(\"listening\", () => {\n        console.log(\"[vite-react-stream] hooking up ws listening\");\n      });\n\n      server.middlewares.use(async (req, res, next) => {\n        if (req.headers.accept !== \"text/x-component\") return next();\n        console.log(\"[vite-react-stream] middleware called\");\n        try {\n          const handler = await createHandler(\n            req.url ?? \"\",\n            {\n              Page: userOptions.Page,\n              props: userOptions.props,\n              build: userOptions.build,\n              Html: ({ children }) => children,\n              pageExportName: userOptions.pageExportName,\n              propsExportName: userOptions.propsExportName,\n              moduleBase: userOptions.moduleBase,\n              moduleBasePath: userOptions.moduleBasePath,\n              projectRoot: server.config.root ?? userOptions.projectRoot,\n            },\n            {\n              cssFiles: Array.from(cssModules),\n              logger: createLogger(),\n              loader: server.ssrLoadModule,\n              moduleGraph: server.moduleGraph,\n            }\n          );\n          handler?.stream?.pipe(res);\n        } finally {\n          res.on(\"close\", () => {\n            console.log(\"[vite-react-stream] âž– Stream closed for:\", req.url);\n            activeStreams.delete(res);\n          });\n        }\n      });\n    },\n\n    async config(config, configEnv): Promise<UserConfig> {\n      const resolvedPages = await resolvePages(userOptions.build.pages);\n      if (resolvedPages.type === \"error\") {\n        throw resolvedPages.error;\n      }\n      const { pages } = resolvedPages;\n      env = getEnv(config, configEnv);\n      define = env.define;\n      files = await checkFilesExist(\n        pages,\n        userOptions,\n        config.root ?? userOptions.projectRoot\n      );\n      root = config.root ?? userOptions.projectRoot;\n      const resolvedConfig = resolveUserConfig(\n        \"react-server\",\n        config,\n        configEnv,\n        userOptions\n      );\n      if (resolvedConfig.type === \"error\") {\n        throw resolvedConfig.error;\n      }\n      userConfig = resolvedConfig.userConfig;\n      console.log({\n        worker: userOptions.workerPath,\n        loader: userOptions.loaderPath,\n        manifest: userConfig.build.manifest,\n        ssrManifest: userConfig.build.ssrManifest,\n      });\n      const inputNormalizer = createInputNormalizer({\n        root,\n        condition: 'react-server',\n      });\n      const entriesClient = Object.fromEntries([\n        ...Object.entries(clientComponents).map(inputNormalizer),\n      ]);\n      const mapToStubIndex = ([key,value]: [string, string]) => {\n        const stub = key.replace(DEFAULT_CONFIG.FILE_REGEX, '');\n        const replaceFileName = stub.split(sep).pop();\n        const stubIndex = stub.replace(replaceFileName ?? userOptions.pageExportName, 'index');\n        return [\n          [stubIndex, 'index.html'],\n          [stub, value],\n        ]\n      }\n      const mapToJSON = ([key,value]: [string, string]) => {\n        const stub = key.replace(DEFAULT_CONFIG.FILE_REGEX, '')\n        return [stub, value]\n      }\n      const serverEntries = Object.fromEntries([\n        ...Array.from(Object.entries(entriesClient)),\n        ...Array.from(files.pageSet.entries()).flatMap(mapToStubIndex),\n        ...Array.from(files.propsSet.entries()).map(mapToJSON),\n        [userOptions.workerPath, userOptions.workerPath],\n        [userOptions.loaderPath, userOptions.loaderPath],\n      ]);\n\n      const buildConfig = {\n        ...createBuildConfig({\n          condition: 'react-server',\n          input: serverEntries,\n          userConfig: userConfig,\n          userOptions: userOptions,\n          root,\n          nodeRoot,\n          pluginRoot,\n          moduleBase: userOptions.moduleBase,\n          temporaryReferences: new WeakMap(),\n          moduleBaseExceptions: [\n            // no file extension\n            userOptions.workerPath,\n            userOptions.loaderPath,\n            userOptions.clientEntry,\n            ...userOptions.moduleBaseExceptions,\n          ].map(exception => {\n            const normal = normalizePath(exception)\n            const removeExt = normal.replace(/\\.[^.]+$/, '')\n            const removeLeadingSlash = removeExt.startsWith('/') ? removeExt.slice(1) : removeExt\n            return removeLeadingSlash\n          }),\n        }),\n        define,\n        plugins: config.plugins,\n      };\n      console.log('RETURNING SERVER CONFIG',{rollup: buildConfig.build?.rollupOptions})\n      return buildConfig\n    },\n    async buildStart() {\n      timing.buildStart = performance.now();\n    },\n    async closeBundle() {\n      if (!config) return;\n      console.log(\"RSC CLOSE BUNDLE CALLED\");\n      if (!files.pageSet.size) return;\n      timing.renderStart = performance.now();\n      const moduleGraph = this.getModuleIds();\n      for(const module of moduleGraph) {\n        console.log(module)\n      }\n      try {\n          const resolvedServerManifest = tryManifest({\n            root,\n            outDir: userOptions.build.server,\n            ssrManifest: false,\n          });\n        if (resolvedServerManifest.type === \"error\") {\n          console.error(\n            \"[vite-react-stream] Server Build failed, can not build without a server manifest.\",\n            resolvedServerManifest.error\n          );\n          return;\n        }\n        const { manifest: serverManifest } = resolvedServerManifest;\n\n        // get worker path from server manifest\n        const workerPath =\n          serverManifest[userOptions.workerPath]?.file ??\n          serverManifest[relative(root, userOptions.workerPath)]?.file ??\n          serverManifest[\n            relative(\n              join(root, userOptions.build.server),\n              userOptions.workerPath\n            )\n          ]?.file;\n        if (!workerPath) {\n          console.log(serverManifest, userOptions.build.server);\n          throw new Error(\n            `Worker path not found in server manifest, tried: ${userOptions.workerPath}, ${relative(root, userOptions.workerPath)}, ${join(root, userOptions.build.server, userOptions.workerPath)}`\n          );\n        }\n        console.log(\"workerPath\", workerPath);\n        // client\n        const resolvedClientManifest = tryManifest({\n          root,\n          outDir: userOptions.build.client,\n          ssrManifest: false,\n        });\n        if (resolvedClientManifest.type === \"error\") {\n          console.error(\n            \"[vite-react-stream] Server Build failed, can not build without a client manifest. Make sure to run the client build before the server build and set `manifest: true` in your vite config.\",\n            resolvedClientManifest.error\n          );\n          return;\n        }\n        const { manifest: clientManifest } = resolvedClientManifest;\n\n        // Create a single worker for all routes\n        if (!worker)\n          worker = await createWorker({\n            workerPath: join(root, userOptions.build.server, workerPath),\n            nodePath: process.env[\"NODE_PATH\"] ?? resolve(root, \"node_modules\"),\n            mode:\n              process.env[\"NODE_ENV\"] === \"development\"\n                ? \"development\"\n                : \"production\",\n          });\n        // this is based on the user config - the routes should lead to a page and props but the rendering is agnostic of that\n        const routes = Array.from(files.pageMap.keys());\n        const indexEntry = clientManifest[\"index.html\"];\n        if (!indexEntry) {\n          throw new Error(\"root /index.html not found\");\n        }\n        const { failedRoutes, filesOutputted } = await renderPages(routes, {\n          pipableStreamOptions: {\n            bootstrapModules: [\"/\" + indexEntry.file],\n          },\n          outDir: config.build.outDir,\n          clientCss: indexEntry.css?.map((css) => \"/\" + css) ?? [],\n          pluginOptions: {\n            Page: userOptions.Page,\n            props: userOptions.props,\n            build: userOptions.build,\n            Html: userOptions.Html,\n            pageExportName: userOptions.pageExportName,\n            propsExportName: userOptions.propsExportName,\n            moduleBase: userOptions.moduleBase,\n            moduleBasePath: userOptions.moduleBasePath,\n            moduleBaseURL: userOptions.moduleBaseURL,\n            projectRoot: root,\n          },\n          worker: worker,\n          manifest: clientManifest,\n          loader: createPageLoader({\n            manifest: clientManifest,\n            root: config.root,\n            outDir: config.build.outDir,\n            moduleBase: userOptions.moduleBase,\n            alwaysRegisterServer: false,\n            alwaysRegisterClient: false,\n            registerServer: [],\n            registerClient: Object.keys(resolvedClientManifest).filter(\n              (key) =>\n                key?.endsWith(\".client.tsx\") && clientManifest[key].isEntry\n            ),\n          }),\n          onCssFile: (path) => buildCssFiles.add(path),\n        });\n        if(failedRoutes.size) {\n          console.error(\"[vite-react-stream] Failed to render routes:\", failedRoutes)\n        }\n        if(filesOutputted.length !== routes.length) {\n          console.error(\"[vite-react-stream] Failed to render routes:\", filesOutputted)\n        }\n        console.log(\"[vite-react-stream] Render complete\");\n        console.log(\"[vite-react-stream] Terminating worker\");\n        if (worker) await worker.terminate();\n\n        timing.renderEnd = performance.now();\n        timing.total = (timing.renderEnd - timing.start) / 1000;\n\n        // Collect stats\n        const stats: BuildStats = {\n          htmlFiles: routes.length,\n          clientComponents: clientComponents.size,\n          cssFiles: cssModules.size,\n          totalRoutes: routes.length,\n          timing: {\n            config: ((timing.configResolved ?? 0) - timing.start) / 1000,\n            build:\n              ((timing.buildStart ?? 0) - (timing.configResolved ?? 0)) / 1000,\n            render:\n              ((timing.renderEnd ?? 0) - (timing.renderStart ?? 0)) / 1000,\n            total: (timing.renderEnd ?? 0 - timing.start) / 1000,\n          },\n        };\n\n        // Format duration helper\n        const formatDuration = (seconds: number) => {\n          if (seconds < 0.001) {\n            return `${(seconds * 1000000).toFixed(0)}Î¼s`;\n          }\n          if (seconds < 1) {\n            return `${(seconds * 1000).toFixed(0)}ms`;\n          }\n          return `${seconds.toFixed(2)}s`;\n        };\n\n        console.log(\"\\n[vite-react-stream] Build Summary:\");\n        console.log(\"â”€\".repeat(50));\n        console.log(`ðŸ“„ Generated ${stats.htmlFiles} HTML files`);\n        console.log(`ðŸŽ¯ Processed ${stats.clientComponents} client components`);\n        console.log(`ðŸŽ¨ Included ${stats.cssFiles} CSS files`);\n        console.log(`ðŸ›£ï¸  Total routes: ${stats.totalRoutes}`);\n        console.log(\"â”€\".repeat(50));\n        console.log(\"â±ï¸  Timing:\");\n        console.log(`  Config:  ${formatDuration(stats.timing.config)}`);\n        console.log(`  Build:   ${formatDuration(stats.timing.build)}`);\n        console.log(`  Render:  ${formatDuration(stats.timing.render)}`);\n        console.log(\"  \".repeat(12));\n        console.log(`  Total:   ${formatDuration(stats.timing.total)}`);\n        console.log(\"â”€\".repeat(50));\n      } catch (error) {\n        console.error(\"[vite-react-stream] Build failed:\", error);\n        throw error;\n      }\n    },\n    async buildEnd(error) {\n      if (error) {\n        console.error(\"[vite-react-stream] Build error:\", error);\n      }\n      if (worker) await worker.terminate();\n    },\n    handleHotUpdate({ file }) {\n      if (file.endsWith(\".css\")) {\n        cssModules.add(file);\n      }\n    },\n    transform(code: string, id: string) {\n      if (\n        (id.includes(\".client\") ||\n          code.startsWith('\"use client\"') ||\n          code.startsWith(\"use client\")) &&\n        !id.includes(\"node_modules\")\n      ) {\n        console.log(\"[vite-react-stream] Client component added\", id);\n        clientComponents.set(id, code);\n      }\n      return { code };\n    },\n  };\n}\n"]}